Noverse Bug Reporting Template
==============================

Title: smithyEffect() produces incorrect handCount, and deckCount values.   

Class: Unit test failure

Date: 29 May 2019          
Reported By: Daniel Green  
Email: greendan@oregonstate.edu     

Product: Dominion               Version: assignment-2
Platform: Ubuntu 18.04.2 LTS, Linux 4.15.0-50-generic
Compiler: gcc version 7.4.0

Is it reproducible: Yes

Description
===========
The unit test cardtest2 tests smithyEffect() as defined in dominion.c. It checks for a variety of correct values, and upon execution it detected two failures in testSmithy().
After the card is played, the number of cards in the players hand is incorrect and the number of cards in the players deck is also incorrect. 

unit test debug output:
*** cardtest2 failed at handCnt, incorrect num of cards in players hand
*** cardtest2 failed at deckCnt, incorrect num of cards in players deck
==== testSmithyCard() failed.
Set CARDTEST2_DEBUG to 1 for debug info
Function 'updateCoins'
Lines executed:81.82% of 11
Branches executed:100.00% of 8

Steps to Produce/Reproduce
--------------------------
/bin/sh make cardtests
This compiles dominion.c without linkage and causes the compiler warning.


Expected Results
----------------
Makefile recipe printed to stdout without warnings or errors.


Actual Results
--------------
Two reported errors generated by cardtest2 unit tests. The errors report that smithyEffect is not correctly updating the handCnt, or deckCnt variables after playing the card.


Workarounds
-----------
Currently no workaround, the card is unplayable in it's current state.


fix
-----------
cardtest2.c:
All tests PASS
Function 'updateCoins'
Lines executed:81.82% of 11
Branches executed:100.00% of 8
Taken at least once:75.00% of 8

The fix was to first inspect the code manually, this was easy due to the simple nature of the smithyEffect Card.
I found two bugs,
1. the first was that the for loop that was responsible for drawing cards into the players hand was set to draw cards when the counter variable i was greater than a 3, which is incorrect. 
2. I also found that the drawcard() function was repeated twice in the body of the for loop.

After fixing these two biugs, the report showed all tests passing. wit 100% branch coverage.
